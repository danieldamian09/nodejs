<%- include("template/cabecera.ejs", {tituloWeb: 'Detalle de mascota' }) %>


<!-- Viene  de Mascotas.js leer un unico docuemnto -->

    <div class="container">
        <h1>Detalle Mascota</h1>
        <% if (error) { %>

            <p>
                <%= mensaje %>
            </p>
            <a href="/mascotas" class="btn btn-dark btn-block">Volver a Mascotas</a>

            <% } %>

                <% if (!error) { %>

                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Nombre</th>
                                <th scope="col">Descripcion</th>
                                <th scope="col">Accion</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">
                                    <%= mascota.id %>
                                </th>
                                <td>
                                    <%= mascota.nombre %>
                                </td>
                                <td>
                                    <%= mascota.descripcion %>
                                </td>
                                <td>
                                    <!--Debemos hacer que el boton viaje a la ruta que creamos  -->
                                    <!-- podemos enviar la data del id atraves del data-id="" -->
                                    <button
                                        class="btn btn-danger btn-sm"
                                        id="btnEliminar"
                                        data-id="<%= mascota.id %>"
                                    </button>
                                    >
                                        Eliminar
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                <% } %>
    </div>

    <%- include("template/footer.ejs") %>

    <!-- aca utilizamos el script para el boton de eliminar -->

    <script>

        const btnEliminar = document.querySelector('#btnEliminar')

        btnEliminar.addEventListener('click', async() => {
            console.log('Me diste click')

            // creamos esta constante con los datos que vienen de la clase data-id del boton
            const id = btnEliminar.dataset.id
            console.log('id', id);

            // aca vamos a utilizar fetch

            try {
                const data = await fetch(`/mascotas/${id}`, {
                    method: 'delete'
                })
                const res = await data.json()
                // console.log(res)
                if (res.estado) {
                    // si res.estado que viene del json de Mascotas.js es verdadero podemos redirigir al usuario con:
                    window.location.href = '/mascotas'
                
                } else {
                    console.log(res)
                }

            } catch (error) {
                console.log(error)
            }


        })

    </script>